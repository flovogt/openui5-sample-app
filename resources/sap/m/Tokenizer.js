/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/base/i18n/Localization","sap/m/Button","sap/m/List","sap/m/StandardListItem","sap/m/ResponsivePopover","sap/ui/core/Core","sap/ui/core/ControlBehavior","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/delegate/ScrollEnablement","sap/ui/base/ManagedObjectObserver","sap/ui/Device","sap/ui/core/InvisibleText","sap/ui/core/ResizeHandler","./TokenizerRenderer","sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","sap/base/Log","sap/ui/core/Theming","sap/ui/core/theming/Parameters","sap/ui/dom/jquery/scrollLeftRTL"],function(e,t,o,i,n,s,r,a,l,p,h,d,u,c,f,g,T,k,_,m,y,v){"use strict";var b="sapUiNoContentPadding";var I="sapMTokenizerTokensPopup";var R=e.TokenizerRenderMode;var S=e.PlacementType;var M=e.ListMode;var C=e.ListType;var E=e.ButtonType;var P=l.extend("sap.m.Tokenizer",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.ui.core.ISemanticFormContent"],library:"sap.m",properties:{editable:{type:"boolean",group:"Misc",defaultValue:true},enabled:{type:"boolean",group:"Misc",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},maxWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},renderMode:{type:"string",group:"Misc",defaultValue:R.Narrow},hiddenTokensCount:{type:"int",group:"Misc",defaultValue:0,visibility:"hidden"},opener:{type:"string",multiple:false,visibility:"hidden"},name:{type:"string",group:"Misc",defaultValue:""},displayOnly:{type:"boolean",group:"Behavior",defaultValue:false},_semanticFormValue:{type:"string",group:"Behavior",defaultValue:"",visibility:"hidden"},multiLine:{type:"boolean",group:"Misc",defaultValue:false},showClearAll:{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"tokens",aggregations:{tokens:{type:"sap.m.Token",multiple:true,singularName:"token"},_tokensInfo:{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{tokenChange:{deprecated:true,parameters:{type:{type:"string"},token:{type:"sap.m.Token"},tokens:{type:"sap.m.Token[]"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}},tokenUpdate:{deprecated:true,allowPreventDefault:true,parameters:{type:{type:"string"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}},tokenDelete:{parameters:{tokens:{type:"sap.m.Token[]"},keyCode:{type:"number"}}},renderModeChange:{parameters:{renderMode:{type:"string"}}}}},renderer:T});var L=h.getResourceBundleFor("sap.m");P.prototype.init=function(){this.allowTextSelection(false);this._oTokensWidthMap={};this._oIndicator=null;this._bInForm=false;this._bShouldRenderTabIndex=null;this._oScroller=new d(this,this.getId()+"-scrollContainer",{horizontal:true,vertical:false,nonTouchScrolling:true});this._fFontSizeRatio=1;if(a.isAccessibilityEnabled()){var e=new f({text:L.getText("TOKENIZER_ARIA_NO_TOKENS")});this.setAggregation("_tokensInfo",e)}this.attachEvent("delete",function(e){var t=e.getSource();var o=this.getSelectedTokens();var i=!!o.length&&o[o.indexOf(t)+1]||o[o.indexOf(t)-1];this._fireCompatibilityEvents(t,o);this.fireEvent("tokenDelete",{tokens:[t]});if(i){i.focus()}e.cancelBubble()},this);this._bThemeApplied=false;this._handleThemeApplied=()=>{this._bThemeApplied=true;y.detachApplied(this._handleThemeApplied)};y.attachApplied(this._handleThemeApplied);this._observeTokens()};P.prototype._fireCompatibilityEvents=function(e,t){this.fireTokenChange({type:P.TokenChangeType.Removed,token:e,tokens:t.length?t:[e],addedTokens:[],removedTokens:t.length?t:[e]});this.fireTokenUpdate({type:P.TokenChangeType.Removed,addedTokens:[],removedTokens:t.length?t:[e]})};P.prototype._handleNMoreIndicatorPress=function(){this._bIsOpenedByNMoreIndicator=true;this._togglePopup(this.getTokensPopup(),this._getEffectiveOpener())};P.prototype._getEffectiveOpener=function(){return document.getElementById(this.getProperty("opener"))||this.getDomRef()};P.prototype._getTokensList=function(){if(!this._oTokensList){this._oTokensList=new i({width:"auto",mode:M.Delete}).attachDelete(this._handleListItemDelete,this).attachItemPress(this._handleListItemPress,this)}return this._oTokensList};P.prototype.getFormFormattedValue=function(){this._bInForm=true;const e=this.getTokens().map(function(e){return e.getText()}).join(", ");if(!e){return"â€“"}return e};P.prototype.getFormValueProperty=function(){return"_semanticFormValue"};P.prototype.getFormObservingProperties=function(){return["_semanticFormValue"]};P.prototype.getFormRenderAsControl=function(){if(this.getDisplayOnly()&&!this.getTokens().length){return false}else{return this.getDisplayOnly()}};P.prototype.updateFormValueProperty=function(){this.setProperty("_semanticFormValue",this.getFormFormattedValue(),true)};P.prototype._setPopoverMode=function(e){var t=this.getTokensPopup();var o={showArrow:true,placement:S.VerticalPreferredBottom};t.setShowArrow(o.showArrow);t.setPlacement(o.placement);this._getTokensList().setMode(e)};P.prototype._fillTokensList=function(e,t){e.destroyItems();t=t?t:function(){return true};this.getTokens().filter(t).forEach(function(t){e.addItem(this._mapTokenToListItem(t))},this)};P.prototype._handleListItemDelete=function(e){var t=e.getParameter("listItem");var o=t&&t.data("tokenId");var i;i=this.getTokens().filter(function(e){return e.getId()===o&&e.getEditable()})[0];if(i){this.fireTokenUpdate({addedTokens:[],removedTokens:[i],type:P.TokenUpdateType.Removed});this.fireTokenDelete({tokens:[i]});this._adjustTokensVisibility()}};P.prototype._handleListItemPress=function(e){var t=e.getParameter("listItem");var o=t&&t.data("tokenId");var i=this.getTokens().filter(function(e){return e.getId()===o})[0];if(i){i.firePress()}};P.prototype.focusFirstTokenItem=function(){const e=this._getTokensList();const t=e.getItems();if(t.length){t[0].focus()}};P.prototype._handleTokenizerAfterOpen=function(e){this.focusFirstTokenItem();this.setRenderMode(R.Loose);this.fireRenderModeChange({renderMode:R.Loose})};P.prototype.addPopupClasses=function(e){if(e.hasStyleClass(I)){return}e.addStyleClass(I);e.addStyleClass(b)};P.prototype.getTokensPopup=function(){var e=this._getTokensList();if(this._oPopup){return this._oPopup}this._oPopup=new s({showArrow:true,showHeader:c.system.phone,placement:S.Auto,offsetX:0,offsetY:3,horizontalScrolling:false,title:this._getDialogTitle(),content:this._getTokensList()}).attachBeforeOpen(function(){var t=this.getEditable()?120:32,o=this._oPopup,i=function(){var e=this.getDomRef()&&this.getDomRef().parentElement;var t="Cozy";if(!e){return t}if(e.closest(".sapUiSizeCompact")!==null||document.body.classList.contains("sapUiSizeCompact")){t="Compact"}return t}.bind(this),n=new Promise(function(e){v.get({name:["_sap_m_Tokenizer_FontSizeRatio"+i()],callback:function(t){var o=parseFloat(t);if(isNaN(o)){e(this._fFontSizeRatio);return}e(o)}.bind(this)})}.bind(this));if(o.getContent&&!o.getContent().length){o.addContent(e)}this._fillTokensList(e);t+=Object.keys(this._oTokensWidthMap).map(function(e){return this._oTokensWidthMap[e]},this).sort(function(e,t){return e-t}).pop()||0;n.then(function(e){t+=Math.ceil(t*(1-e));o.setContentWidth(t+"px")})},this).attachAfterClose(this.afterPopupClose,this).attachAfterOpen(this._handleTokenizerAfterOpen,this);this.addDependent(this._oPopup);this.addPopupClasses(this._oPopup);if(c.system.phone){this._oPopup.setEndButton(new o({text:L.getText("SUGGESTIONSPOPOVER_CLOSE_BUTTON"),type:E.Emphasized,press:function(){this._oPopup.close()}.bind(this)}))}return this._oPopup};P.prototype.afterPopupClose=function(){if(!this.checkFocus()){this.setRenderMode(R.Narrow);this.fireRenderModeChange({renderMode:"Narrow"})}};P.prototype._getDialogTitle=function(){var e=h.getResourceBundleFor("sap.m");var t=this.getAriaLabelledBy().map(function(e){return p.getElementById(e)});return t.length?t[0].getText?.():e.getText("COMBOBOX_PICKER_TITLE")};P.prototype._togglePopup=function(){var e=this._getEffectiveOpener(),t=this.getTokensPopup(),o=t.isOpen(),i=this.getEditable();this._setPopoverMode(i?M.Delete:M.None);if(o){t.close()}else{t.openBy(e)}};P.prototype._mapTokenToListItem=function(e){if(!e){return null}var t=new n({selected:true,wrapping:true,type:C.Active,wrapCharLimit:1e4}).data("tokenId",e.getId());var o=function(e){this._togglePopup(this.getTokensPopup());if(this.getTokens().length&&this._bIsOpenedByNMoreIndicator){this.getTokens()[0].focus();this._bIsOpenedByNMoreIndicator=false}};t.setTitle(e.getText());t.addDelegate({onkeydown:function(e){e.preventDefault();if(!((e.ctrlKey||e.metaKey)&&e.which===_.I)&&e.which!==_.ESCAPE){return}this._togglePopup(this.getTokensPopup());if(this.getTokens().length&&this._bIsOpenedByNMoreIndicator){this.getTokens()[0].focus();this._bIsOpenedByNMoreIndicator=false}},onsapshow:o,onsaphide:o},this);return t};P.prototype._getPixelWidth=function(){var e=this.getMaxWidth(),t,o=this.getDomRef("inner")||this.getDomRef(),i;if(!o){return}i=parseInt(this.$().css("padding-left"));if(e.indexOf("px")===-1){t=o.clientWidth}else{t=parseInt(this.getMaxWidth())}return t-i};P.prototype._adjustTokensVisibility=function(){if(!this.getDomRef()){return}var e=this._getPixelWidth(),t=this._getVisibleTokens(),o=t.length,i,n,s,r=-1;if(this.getMultiLine()){t.forEach(function(t){const o=e-this._oTokensWidthMap[t.getId()];if(o<=0){t.setTruncated(true)}},this);return}t.some(function(t,o){e=e-this._oTokensWidthMap[t.getId()];if(e<0){r=o;return true}else{n=e;return false}},this);if(o===1&&r!==-1){this.setFirstTokenTruncated(true);return}else if(o===1&&t[0].getTruncated()){this.setFirstTokenTruncated(false)}if(r>-1){for(s=0;s<o;s++){if(s>=r){t[s].addStyleClass("sapMHiddenToken")}else{t[s].removeStyleClass("sapMHiddenToken")}}this._handleNMoreIndicator(o-r);i=this._oIndicator.width();if(i>=n){r=r-1;this._handleNMoreIndicator(o-r);t[r].addStyleClass("sapMHiddenToken")}this._setHiddenTokensCount(o-r)}else{this._setHiddenTokensCount(0);this._showAllTokens()}};P.prototype.setFirstTokenTruncated=function(e){var t=this.getTokens()[0];t&&t.setTruncated(e);if(e){this.addStyleClass("sapMTokenizerOneLongToken")}else{this.removeStyleClass("sapMTokenizerOneLongToken")}return this};P.prototype.hasOneTruncatedToken=function(){return this.getTokens().length===1&&this.getTokens()[0].getTruncated()};P.prototype._handleNMoreIndicator=function(e){if(!this.getDomRef()){return this}if(e){let t="MULTIINPUT_SHOW_MORE_TOKENS";if(e===this._getVisibleTokens().length){if(e===1){t="TOKENIZER_SHOW_ALL_ITEM"}else{t="TOKENIZER_SHOW_ALL_ITEMS"}}this._oIndicator.html(L.getText(t,[e]))}return this};P.prototype._getVisibleTokens=function(){return this.getTokens().filter(function(e){return e.getVisible()})};P.prototype._showAllTokens=function(){this._getVisibleTokens().forEach(function(e){e.removeStyleClass("sapMHiddenToken")})};P.prototype.getScrollDelegate=function(){return this._oScroller};P.prototype.scrollToEnd=function(){var e=this.getDomRef(),o=t.getRTL(),i=this.getTokens()[0]&&this.getTokens()[0].getDomRef()&&this.getTokens()[0].getDomRef()===document.activeElement,n,s;if(!this.getDomRef()||i){return}s=this.$().find(".sapMTokenizerScrollContainer")[0];n=s.scrollWidth;if(o){n*=-1}e.scrollLeft=n};P.prototype._registerResizeHandler=function(){if(!this._sResizeHandlerId){this._sResizeHandlerId=g.register(this,this._handleResize.bind(this))}};P.prototype._handleResize=function(){this._useCollapsedMode(this.getRenderMode())};P.prototype.setPixelWidth=function(e){if(typeof e!=="number"){m.warning("Tokenizer.setPixelWidth called with invalid parameter. Expected parameter of type number.");return}this.setWidth(e+"px");if(this._oScroller){this._oScroller.refresh()}};P.prototype.scrollToStart=function(){var e=this.getDomRef();if(!e){return}e.scrollLeft=0};P.prototype.getScrollWidth=function(){if(!this.getDomRef()){return 0}return this.$().children(".sapMTokenizerScrollContainer")[0].scrollWidth};P.prototype.onBeforeRendering=function(){var e=this.getTokens();if(e.length!==1&&!this.getMultiLine()){this.setFirstTokenTruncated(false)}e.forEach(function(t,o){t.setProperty("editableParent",this.getEditable()&&this.getEnabled());t.setProperty("posinset",o+1);t.setProperty("setsize",e.length)},this);this._setTokensAria();if(this.getTokensPopup()&&this.getTokensPopup().isOpen()){const t=this._getTokensList().getItems().length;if(e.length!==t){this._fillTokensList(this._getTokensList())}}};P.prototype.onAfterRendering=function(){var e=this.getRenderMode();var t=this._getTokenToFocus();this._oIndicator=this.$().find(".sapMTokenizerIndicator");if(this._bThemeApplied){this._storeTokensSizes()}this._useCollapsedMode(e);this._registerResizeHandler();if(!this.getEnabled()&&this.getTokens().length){this.getTokens().forEach(function(e){if(!e.getDomRef()){return}e.getDomRef().setAttribute("tabindex","-1")})}if(t&&t.getDomRef()&&this.getEffectiveTabIndex()){t.getDomRef().setAttribute("tabindex","0")}if(this._bFocusFirstToken){this.scrollToStart();this._bFocusFirstToken=false;return}if(e===R.Loose&&this._nMoreIndicatorPressed){this.scrollToEnd()}};P.prototype.onThemeChanged=function(){this._storeTokensSizes();this._useCollapsedMode(this.getRenderMode())};P.prototype._storeTokensSizes=function(){var e=this.getTokens();e.forEach(function(e){if(e.getDomRef()&&!e.$().hasClass("sapMHiddenToken")&&!e.getTruncated()){this._oTokensWidthMap[e.getId()]=e.$().outerWidth(true)}},this)};P.prototype._getTokenToFocus=function(){var e=this._getVisibleTokens();return e.find(e=>e.getSelected())||e[0]};P.prototype._useCollapsedMode=function(e){var t=this._getVisibleTokens();if(!t.length){this._setHiddenTokensCount(0);return}if(e===R.Loose){this._setHiddenTokensCount(0);this._showAllTokens();return}this._adjustTokensVisibility()};P.prototype.onsapfocusleave=function(e){if(document.activeElement===this.getDomRef()||!this.checkFocus()){this._oSelectionOrigin=null}if(!this.checkFocus()){this._bFocusFirstToken=true;this.setRenderMode(R.Narrow);this.fireRenderModeChange({renderMode:"Narrow"})}};P.prototype.onsapbackspace=function(e){var t=this.getSelectedTokens();var o=this.getTokens().filter(function(e){return e.getFocusDomRef()===document.activeElement})[0];var i=this.getTokens();var n=t.length?t:[o];var s=!!t.length&&i[t.indexOf(o)+1]||i[t.indexOf(o)-1];e.preventDefault();if(s){s.focus()}return this.fireTokenDelete({tokens:n,keyCode:e.which})};P.prototype.onsapdelete=P.prototype.onsapbackspace;P.prototype.onkeydown=function(e){var t;var o=(e.ctrlKey||e.metaKey)&&e.which===_.I;if(!this.getEnabled()){return}if(e.which===_.TAB){this._changeAllTokensSelection(false)}if((e.ctrlKey||e.metaKey)&&e.which===_.A){t=this.getSelectedTokens().length<this._getVisibleTokens().length;if(this._getVisibleTokens().length>0){this.focus();this._changeAllTokensSelection(t);e.preventDefault();e.stopPropagation()}}if((e.ctrlKey||e.metaKey)&&(e.which===_.C||e.which===_.INSERT)){this._copy()}if((e.ctrlKey||e.metaKey)&&e.which===_.X||e.shiftKey&&e.which===_.DELETE){if(this.getEditable()){this._cut()}else{this._copy()}}if(o){e.preventDefault();e.stopPropagation();this._togglePopup(this.getTokensPopup());return}};P.prototype.onsaphide=function(e){this._togglePopup(this.getTokensPopup())};P.prototype.onsapshow=P.prototype.onsaphide;P.prototype._shouldPreventModifier=function(e){var t=c.os.macintosh&&e.metaKey;var o=c.os.windows&&e.altKey;return t||o};P.prototype.onsappreviousmodifiers=function(e){if(!this._shouldPreventModifier(e)){this.onsapprevious(e)}};P.prototype._observeTokens=function(){var e=new u(function(e){var t=e.mutation;var o=e.child;switch(t){case"insert":o.attachEvent("_change",this.invalidate,this);break;case"remove":o.detachEvent("_change",this.invalidate,this);break;default:break}this.updateFormValueProperty();this.invalidate()}.bind(this));e.observe(this,{aggregations:["tokens"]})};P.prototype.onsapnextmodifiers=function(e){if(!this._shouldPreventModifier(e)){this.onsapnext(e)}};P.prototype.onsaphomemodifiers=function(e){this._selectRange(false);this.scrollToStart()};P.prototype.onsappageupmodifiers=function(e){this._selectRange(false);this.scrollToStart()};P.prototype.onsapendmodifiers=function(e){this._selectRange(true);this.scrollToEnd()};P.prototype.onsappagedownmodifiers=function(e){this._selectRange(true);this.scrollToEnd()};P.prototype._selectRange=function(e){var t={},o=this._getVisibleTokens(),i=p.closestTo(document.activeElement),n=o.indexOf(i);if(!i||!i.isA("sap.m.Token")){return}if(e){t.start=n;t.end=o.length-1}else{t.start=0;t.end=n}if(t.start<t.end){for(var s=t.start;s<=t.end;s++){o[s].setSelected(true)}}};P.prototype._copy=function(){this._fillClipboard("copy")};P.prototype._fillClipboard=function(e){var t=this.getSelectedTokens();var o=t.map(function(e){return e.getText()}).join("\r\n");var i=function(e){if(e.clipboardData){e.clipboardData.setData("text/plain",o)}else{e.originalEvent.clipboardData.setData("text/plain",o)}e.preventDefault()};document.addEventListener(e,i);document.execCommand(e);document.removeEventListener(e,i)};P.prototype._cut=function(){var e=this.getSelectedTokens();this._fillClipboard("cut");this.fireTokenChange({type:P.TokenChangeType.Removed,token:e,tokens:e,addedTokens:[],removedTokens:e});this.fireTokenUpdate({type:P.TokenChangeType.Removed,addedTokens:[],removedTokens:e});this.fireTokenDelete({tokens:e})};P.prototype._ensureTokenVisible=function(e){if(!e||!e.getDomRef()||!this.getDomRef()){return}var o=this.$().offset().left,i=this.$().width(),n=e.$().offset().left,s=t.getRTL(),r=s?parseInt(e.$().css("margin-left")):parseInt(e.$().css("margin-right")),a=parseInt(e.$().css("border-left-width"))+parseInt(e.$().css("border-right-width")),l=e.$().width()+r+a,p=s?this.$().scrollLeftRTL():this.$().scrollLeft(),h=p-o+n,d=p+(n-o+l-i);if(this._getVisibleTokens().indexOf(e)===0){this.$().scrollLeft(0);return}if(n<o){s?this.$().scrollLeftRTL(h):this.$().scrollLeft(h)}if(n-o+l>i){s?this.$().scrollLeftRTL(d):this.$().scrollLeft(d)}};P.prototype.onfocusin=function(e){this.setRenderMode(R.Loose);this.fireRenderModeChange({renderMode:"Loose"});const t=this.getTokens()[0];this._bFocusFirstToken=e.srcControl===t;if(!this._bFocusFirstToken&&!this._bTokenToBeDeleted){this._ensureTokenVisible(e.srcControl)}};P.prototype.onmousedown=function(e){this._bTokenToBeDeleted=e.target.matches(".sapMTokenIcon, .sapMTokenIcon *")};P.prototype.ontap=function(e){var t=e.shiftKey,o=e.ctrlKey||e.metaKey,i=e.getMark("tokenTap"),n=e.getMark("tokenDeletePress"),s=this._getVisibleTokens(),r,a,l,p,h;if(n||!i||!t&&o){this._oSelectionOrigin=null;return}if(!t){this._oSelectionOrigin=i;this._changeAllTokensSelection(false,i,true)}r=i;if(this._oSelectionOrigin){r=this._oSelectionOrigin}else{this._oSelectionOrigin=r}if(i&&this.hasOneTruncatedToken()&&!this.getMultiLine()){this._handleNMoreIndicatorPress();return}a=this.indexOfToken(r);l=this.indexOfToken(i);p=Math.min(a,l);h=Math.max(a,l);s.forEach(function(e,o){if(o>=p&&o<=h&&t){e.setSelected(i.getSelected())}})};P.prototype.onsapprevious=function(e){var t=this._getVisibleTokens(),o=t.length;e.preventDefault();if(o===0){return}var i=p.closestTo(document.activeElement);var n=i?t.indexOf(i):-1;if(n===0){e.setMarked("forwardFocusToParent");return}var s,r;if(n>0){s=t[n-1];this._ensureTokenVisible(s);s.focus()}else{s=t[t.length-1];this._ensureTokenVisible(s);s.focus({preventScroll:true})}if(e.shiftKey){r=t[n];s.setSelected(true);r.setSelected(true)}e.setMarked()};P.prototype.onsapnext=function(e){var t=this._getVisibleTokens(),o=t.length;e.preventDefault();if(o===0){return}var i=p.closestTo(document.activeElement);var n=i?t.indexOf(i):-1;var s=t[n+1];this._ensureTokenVisible(s);if(n<o-1){var r=t[n];s.focus();if(e.shiftKey){s.setSelected(true);r.setSelected(true)}}else{e.setMarked("forwardFocusToParent");return}e.setMarked()};P.prototype.addValidator=function(e){m.warning("[Warning]:","You are attempting to use deprecated method 'addValidator()', please use MultiInput.prototype.addValidator instead.",this)};P.prototype.removeValidator=function(e){m.warning("[Warning]:","You are attempting to use deprecated method 'addValidator()', please use MultiInput.prototype.addValidator instead.",this)};P.prototype.removeAllValidators=function(){m.warning("[Warning]:","You are attempting to use deprecated method 'addValidator()', please use MultiInput.prototype.addValidator instead.",this)};P.prototype.addValidateToken=function(e){m.warning("[Warning]:","You are attempting to use deprecated method 'addValidator()', please use MultiInput.prototype.addValidator instead.",this)};P.prototype._parseString=function(e){return e.split(/\r\n|\r|\n/g)};P.prototype.checkFocus=function(){var e=this._oPopup&&this._oPopup.getDomRef();var t=k(e,document.activeElement);return this.getDomRef()&&k(this.getDomRef(),document.activeElement)||t};P.prototype.selectAllTokens=function(e){if(e===undefined){e=true}this._changeAllTokensSelection(e);return this};P.prototype._changeAllTokensSelection=function(e,t,o){var i=this._getVisibleTokens();i.filter(function(e){return e!==t}).forEach(function(t){t.setSelected(e)});if(!o){this._doSelect()}return this};P.prototype.getSelectedTokens=function(){return this._getVisibleTokens().filter(function(e){return e.getSelected()})};["onsappageup","onsappagedown","onsaphome","onsapend"].forEach(function(e){P.prototype[e]=function(t){if(e==="onsaphome"||e==="onsappageup"){var o=this.getTokens().filter(function(e){return e.getDomRef()&&!e.getDomRef().classList.contains("sapMHiddenToken")});o.length&&o[0].focus();this.scrollToStart();t.preventDefault();return}var i=this._getVisibleTokens(),n=i[i.length-1];if(n.getDomRef()!==document.activeElement){n.focus();this.scrollToEnd();t.stopPropagation()}else{t.setMarked("forwardFocusToParent")}t.preventDefault()}});P.prototype.setShouldRenderTabIndex=function(e){this._bShouldRenderTabIndex=e};P.prototype.getEffectiveTabIndex=function(){return this._bShouldRenderTabIndex===null?!!this.getTokens().length:this._bShouldRenderTabIndex};P.prototype.onclick=function(e){if(!this.getEnabled()){return}this._nMoreIndicatorPressed=!this.hasOneTruncatedToken()&&!this.hasStyleClass("sapMTokenizerIndicatorDisabled")&&e.target.classList.contains("sapMTokenizerIndicator");if(this._nMoreIndicatorPressed){this._handleNMoreIndicatorPress()}const t=e.target.classList.contains("sapMTokenizerClearAll");if(t){this._handleClearAll()}const o=e.target.classList.contains("sapMTokenTruncated")&&!this.hasStyleClass("sapMTokenizerIndicatorDisabled")&&this.getMultiLine();if(o){this._togglePopup(this.getTokensPopup())}};P.prototype.ontouchstart=function(e){e.setMarked();if(c.browser.chrome&&window.getSelection()){window.getSelection().removeAllRanges()}};P.prototype.exit=function(){this._deregisterResizeHandler();if(this._oTokensList){this._oTokensList.destroy();this._oTokensList=null}if(this._oScroller){this._oScroller.destroy();this._oScroller=null}if(this._oPopup){this._oPopup.destroy();this._oPopup=null}this._oTokensWidthMap=null;this._oIndicator=null;this._aTokenValidators=null;this._bShouldRenderTabIndex=null;this._bInForm=false;this._bThemeApplied=false};P.prototype._deregisterResizeHandler=function(){if(this._sResizeHandlerId){g.deregister(this._sResizeHandlerId);delete this._sResizeHandlerId}};P.prototype._setTokensAria=function(){var e=this._getVisibleTokens().length;var t;var o="";var i="";var n={0:"TOKENIZER_ARIA_NO_TOKENS",1:"TOKENIZER_ARIA_CONTAIN_ONE_TOKEN"};if(a.isAccessibilityEnabled()){t=this.getAggregation("_tokensInfo");i=n[e]?n[e]:"TOKENIZER_ARIA_CONTAIN_SEVERAL_TOKENS";o=L.getText(i,[e]);t.setText(o)}};P.prototype._doSelect=function(){if(this.checkFocus()&&this._bCopyToClipboardSupport){var e=document.activeElement;var t=window.getSelection();t.removeAllRanges();if(this.getSelectedTokens().length){var o=document.createRange();o.selectNodeContents(this.getDomRef("clip"));t.addRange(o)}if(window.clipboardData&&e.id===this.getId()+"-clip"&&this.getDomRef()){this.getDomRef().focus()}}};P.prototype._setHiddenTokensCount=function(e){e=this.validateProperty("hiddenTokensCount",e);return this.setProperty("hiddenTokensCount",e)};P.prototype.getHiddenTokensCount=function(){return this.getProperty("hiddenTokensCount")};P.prototype.getTokensInfoId=function(){return this.getAggregation("_tokensInfo").getId()};P.prototype._handleBackspace=function(e,t){var o=this.getTokens();if(o[e-1]){return o[e-1].focus()}return t()};P.prototype._handleDelete=function(e,t){var o=this.getTokens();if(o[e+1]){return o[e+1].focus()}return t()};P.prototype.focusToken=function(e,t,o){var i=this.getTokens();var n=t.keyCode;var s=t.keyCode===_.BACKSPACE;if(i.length===0){return}if(!n){return}if(s){return this._handleBackspace(e,o)}return this._handleDelete(e,o)};P.prototype._handleClearAll=function(){this.fireTokenDelete({tokens:this.getTokens()})};P.prototype.showEffectiveClearAll=function(){return this.getShowClearAll()&&this.getMultiLine()&&this.getTokens().length>0&&this.getEditable()&&this.getEnabled()};P.prototype._getClearAllText=function(){return r.getLibraryResourceBundle("sap.m").getText("TOKENIZER_CLEAR_ALL")};P.TokenChangeType={Added:"added",Removed:"removed",RemovedAll:"removedAll",TokensChanged:"tokensChanged"};P.TokenUpdateType={Added:"added",Removed:"removed"};return P});
//# sourceMappingURL=Tokenizer.js.map