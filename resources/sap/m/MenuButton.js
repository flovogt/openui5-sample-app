/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","./Button","./SplitButton","sap/ui/Device","sap/ui/core/Element","sap/ui/core/EnabledPropagator","sap/ui/core/library","sap/ui/core/Popup","sap/ui/core/LabelEnablement","./MenuButtonRenderer","sap/base/i18n/Localization","sap/ui/events/KeyCodes"],function(t,e,o,n,i,r,s,a,u,l,p,c,h){"use strict";var d=t.MenuButtonMode;var f=a.TextDirection;var g=t.ButtonType;var y=u.Dock;var m=["buttonMode","useDefaultActionOnly","width","menuPosition"];var _=e.extend("sap.m.MenuButton",{metadata:{interfaces:["sap.m.IToolbarInteractiveControl"],library:"sap.m",properties:{text:{type:"string",group:"Misc",defaultValue:null},type:{type:"sap.m.ButtonType",group:"Appearance",defaultValue:g.Default},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Behavior",defaultValue:true},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:null},activeIcon:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},iconDensityAware:{type:"boolean",group:"Misc",defaultValue:true},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:f.Inherit},buttonMode:{type:"sap.m.MenuButtonMode",group:"Misc",defaultValue:d.Regular},menuPosition:{type:"sap.ui.core.Popup.Dock",group:"Misc",defaultValue:y.BeginBottom},useDefaultActionOnly:{type:"boolean",group:"Behavior",defaultValue:false}},aggregations:{menu:{type:"sap.m.Menu",multiple:false,singularName:"menu"},_button:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{defaultAction:{},beforeMenuOpen:{}},defaultAggregation:"menu",designtime:"sap/m/designtime/MenuButton.designtime",dnd:{draggable:true,droppable:false}},renderer:p});s.call(_.prototype);_.prototype.init=function(){this._initButtonControl()};_.prototype.exit=function(){if(this._sDefaultText){this._sDefaultText=null}if(this._sDefaultIcon){this._sDefaultIcon=null}if(this._lastActionItemId){this._lastActionItemId=null}if(this.getMenu()){this.getMenu().detachClosed(this._menuClosed,this)}};_.prototype.onBeforeRendering=function(){if(!this._sDefaultText){this._sDefaultText=this.getText()}if(!this._sDefaultIcon){this._sDefaultIcon=this.getIcon()}this._updateButtonControl();this._attachMenuEvents()};_.prototype._getTextBtnContentDomRef=function(){return this._getButtonControl()._getTextButton().getDomRef("content")};_.prototype.onAfterRendering=function(){if(this._activeButton){this._activeButton.$().attr("aria-expanded","false");this._activeButton=null}};_.prototype.setButtonMode=function(t){var o=this.getTooltip(),n,i;e.prototype.setProperty.call(this,"buttonMode",t,true);this._getButtonControl().destroy();this._initButtonControl();n=this._getButtonControl();i=n.getMetadata().getAllProperties();for(var s in this.mProperties){if(this.mProperties.hasOwnProperty(s)&&m.indexOf(s)<0&&i.hasOwnProperty(s)){n.setProperty(s,this.mProperties[s],true)}}if(o){n.setTooltip(o)}if(!this._isSplitButton()&&this._sDefaultText){this.setText(this._sDefaultText)}else if(!this.getUseDefaultActionOnly()&&this._getLastSelectedItem()){this.setText(r.getElementById(this._getLastSelectedItem()).getText())}if(!this._isSplitButton()&&this._sDefaultIcon){this.setIcon(this._sDefaultIcon)}else if(!this.getUseDefaultActionOnly()&&this._getLastSelectedItem()){this.setIcon(r.getElementById(this._getLastSelectedItem()).getIcon())}this.invalidate();return this};_.prototype._initButton=function(){var t=new o(this.getId()+"-internalBtn",{width:"100%",ariaHasPopup:a.aria.HasPopup.Menu});t.attachPress(this._handleButtonPress,this);t.onkeydown=this.handleKeydown;return t};_.prototype._initSplitButton=function(){var t=new n(this.getId()+"-internalSplitBtn",{width:"100%"});t.attachPress(this._handleActionPress,this);t.attachArrowPress(this._handleButtonPress,this);t._getArrowButton().onkeydown=this.handleKeydown;return t};_.prototype._initButtonControl=function(){var t;if(this._isSplitButton()){t=this._initSplitButton()}else{t=this._initButton()}this.setAggregation("_button",t,true)};_.prototype._updateButtonControl=function(){this._getButtonControl().setText(this.getText())};_.prototype._getButtonControl=function(){return this.getAggregation("_button")};_.prototype._parseDockAlignment=function(t){let e="Begin";let o="Bottom";if(t.substring(0,5)==="Begin"){e="Begin"}else if(t.substring(0,3)==="End"){e="End"}else if(t.substring(0,4)==="Left"){e="Left"}else if(t.substring(0,5)==="Right"){e="Right"}else if(t.substring(0,6)==="Center"){e="Center"}if(t.substring(t.length-3)==="Top"){o="Top"}else if(t.substring(t.length-6)==="Bottom"){o="Bottom"}else if(t.substring(t.length-6)==="Center"){o="Center"}return{sHorizontalAlign:e,sVerticalAlign:o}};_.prototype._adjustPopoverPosition=function(t,e,o){const{sHorizontalAlign:n,sVerticalAlign:i}=this._parseDockAlignment(t),r=e._oControl.getDomRef(),s=r.getBoundingClientRect(),a=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,u=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,l=n==="Left"||n==="Right",p=c.getRTL();let h,d,f=0,g=0;switch(n){case"Begin":h=p?o.right+a-s.width:o.left+a;f=p?-1:1;break;case"End":h=p?o.left+a:o.right+a-s.width;f=p?1:-1;break;case"Left":h=o.left+a-s.width;f=-2;break;case"Right":h=o.right+a;f=2;break;default:var y=o.left+o.width/2+a;h=y-s.width/2}switch(i){case"Top":d=l?o.top+o.height+u-s.height:o.top+u-s.height;g=l?-5:2;break;case"Bottom":d=l?o.top+u:o.top+o.height+u;g=l?5:-2;break;default:var m=o.top+o.height/2+u;d=m-s.height/2}r.style.left=Math.round(h+f)+"px";r.style.top=Math.round(d+g)+"px";r.style.right="";r.style.bottom="";e.detachEvent("afterOpen",this._adjustPopoverPosition)};_.prototype._destroyAnchorElement=function(t){if(this._menuButtonAnchor&&this._menuButtonAnchor.parentNode){this._menuButtonAnchor.parentNode.removeChild(this._menuButtonAnchor)}this._menuButtonAnchor=null;t&&t.detachEvent("afterClose",this._destroyAnchorElement)};_.prototype._createAnchorElement=function(t){this._destroyAnchorElement();const e=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=t.left+t.width/2+e,i=t.top+t.height/2+o,r=document.createElement("div");r.style.position="absolute";r.style.width="1px";r.style.height="1px";r.style.left=Math.round(n)+"px";r.style.top=Math.round(i)+"px";r.style.zIndex="2147483647";r.style.pointerEvents="none";r.setAttribute("aria-hidden","true");r.className="sapMMenuButtonAnchor";document.body.appendChild(r);this._menuButtonAnchor=r};_.prototype._createMenuPositionAnchor=function(t,e){if(!t||!e||!y[t]){return}const o=this.getDomRef().getBoundingClientRect();this._createAnchorElement(o);e.attachEvent("afterOpen",this._adjustPopoverPosition.bind(this,t,e,o));e.attachEvent("afterClose",this._destroyAnchorElement.bind(this,e))};_.prototype._handleButtonPress=function(t){var e=this.getMenu();this.fireBeforeMenuOpen();if(!e){return}if(e.isOpen()&&!t.getParameter("keyboard")){e.close();this._bPopupOpen=false;return}if(!e.getTitle()){e.setTitle(this.getText())}var o=[this,t.getParameter("keyboard")];var n=e._getPopover();var r=this.getMenuPosition();if(r&&n){this._createMenuPositionAnchor(r,n)}e.openBy.apply(e,o);if(this.getMenu()){this._bPopupOpen=true}this._writeAriaAttributes();if(this._isSplitButton()&&!i.system.phone){this._getButtonControl().setArrowState(true)}};_.prototype._handleActionPress=function(){var t=this._getLastSelectedItem(),e;if(!this.getUseDefaultActionOnly()&&t){e=r.getElementById(t);this.getMenu().fireItemSelected({item:e})}else{this.fireDefaultAction()}};_.prototype._menuClosed=function(){var t=this._getButtonControl(),e=t,o=this.getMenu(),n=o&&o._getPopover();if(this._isSplitButton()){t.setArrowState(false);e=t._getArrowButton()}if(n&&!n.isOpen()){this._bPopupOpen=false}e.$().removeAttr("aria-controls");e.$().attr("aria-expanded","false")};_.prototype._menuItemSelected=function(t){var e=t.getParameter("item");this.fireEvent("_menuItemSelected",{item:e});this._bPopupOpen=false;if(!this._isSplitButton()||this.getUseDefaultActionOnly()||!e){return}this._lastActionItemId=e.getId();!!this._sDefaultText&&this.setText(e.getText());!!this._sDefaultIcon&&this.setIcon(e.getIcon())};_.prototype._getLastSelectedItem=function(){return this._lastActionItemId};_.prototype._attachMenuEvents=function(){if(this.getMenu()){this.getMenu().attachClosed(this._menuClosed,this);this.getMenu().attachItemSelected(this._menuItemSelected,this)}};_.prototype._isSplitButton=function(){return this.getButtonMode()===d.Split};_.prototype.setProperty=function(t,o,n){function i(t){var e=[g.Up,g.Back,g.Unstyled];return e.indexOf(t)!==-1}if(t==="type"&&i(o)){return this}if(t==="text"){this._sDefaultText=o}switch(t){case"activeIcon":case"iconDensityAware":case"textDirection":case"visible":case"enabled":this._getButtonControl().setProperty(t,o);break}return e.prototype.setProperty.apply(this,arguments)};_.prototype.setTooltip=function(t){this._getButtonControl().setTooltip(t);return e.prototype.setTooltip.apply(this,arguments)};_.prototype.setText=function(t){e.prototype.setProperty.call(this,"text",t);this._getButtonControl().setText(t);return this};_.prototype.setType=function(t){e.prototype.setProperty.call(this,"type",t);this._getButtonControl().setType(t);return this};_.prototype.setIcon=function(t){e.prototype.setProperty.call(this,"icon",t);this._getButtonControl().setIcon(t);return this};_.prototype.addAriaLabelledBy=function(t){this.getAggregation("_button").addAssociation("ariaLabelledBy",t);return e.prototype.addAssociation.call(this,"ariaLabelledBy",t)};_.prototype.addAriaDescribedBy=function(t){this.getAggregation("_button").addAssociation("ariaDescribedBy",t);return e.prototype.addAssociation.call(this,"ariaDescribedBy",t)};_.prototype.removeAriaLabelledBy=function(t){this.getAggregation("_button").removeAssociation("ariaLabelledBy",t);return e.prototype.removeAssociation.call(this,"ariaLabelledBy",t)};_.prototype.removeAriaDescribedBy=function(t){this.getAggregation("_button").removeAssociation("ariaDescribedBy",t);return e.prototype.removeAssociation.call(this,"ariaDescribedBy",t)};_.prototype.removeAllAriaLabelledBy=function(t){this.getAggregation("_button").removeAllAssociation("ariaLabelledBy");return e.prototype.removeAllAssociation.call(this,"ariaLabelledBy")};_.prototype.removeAllAriaDescribedBy=function(){this.getAggregation("_button").removeAllAssociation("ariaDescribedBy");return e.prototype.removeAllAssociation.call(this,"ariaDescribedBy")};_.prototype.getFocusDomRef=function(){return this._getButtonControl().getDomRef()};_.prototype.onsapup=function(t){this.openMenuByKeyboard();t.stopPropagation()};_.prototype.onsapdown=function(t){this.openMenuByKeyboard();t.stopPropagation()};_.prototype.onsapupmodifiers=function(t){this.openMenuByKeyboard();t.stopPropagation()};_.prototype.onsapdownmodifiers=function(t){this.openMenuByKeyboard();t.stopPropagation()};_.prototype.onsapshow=function(t){this.openMenuByKeyboard();!!t&&t.preventDefault()};_.prototype.ontouchstart=function(){const t=this.getMenu(),e=t&&t._getPopover();this._bPopupOpen=t&&e&&e.isOpen()};_.prototype.handleKeydown=function(t){if((t.keyCode===h.ENTER||t.keyCode===h.TAB)&&this._bPopupOpen){this.getMenu().close();this._bPopupOpen=false}o.prototype.onkeydown.call(this,t)};_.prototype.openMenuByKeyboard=function(){if(!this._isSplitButton()){this._handleButtonPress(Object.create(null,{getParameter:{value:function(){return true}}}))}};_.prototype._writeAriaAttributes=function(){var t=this._getButtonControl(),e=this._isSplitButton()?t._getArrowButton():t,o=this.getMenu();if(o){e.$().attr("aria-controls",o.getDomRefId());e.$().attr("aria-expanded","true")}};_.prototype._getToolbarInteractive=function(){return true};_.prototype.getIdForLabel=function(){return this.getId()+"-internalBtn"};_.prototype._ensureBackwardsReference=function(){var t=this._getButtonControl(),e=t.getAriaLabelledBy(),o=l.getReferencingLabels(this);o.forEach(function(o){if(e&&e.indexOf(o)===-1){t.addAriaLabelledBy(o)}});return this};return _});
//# sourceMappingURL=MenuButton.js.map