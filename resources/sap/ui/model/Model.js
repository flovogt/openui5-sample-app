/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/message/MessageProcessor","./ManagedObjectBindingSupport","./BindingMode","./Context","./Filter","sap/base/Log","sap/base/util/deepEqual","sap/base/util/each"],function(t,e,i,n,s,r,o,a){"use strict";var h=t.extend("sap.ui.model.Model",{constructor:function(){t.apply(this,arguments);this.aBindings=[];this.oBindingsToRemove=new Set;this.mContexts={};this.oData={};this.sDefaultBindingMode=i.TwoWay;this.bDestroyed=false;this.bForceUpdate=undefined;this.bLegacySyntax=false;this.mMessages={};this.sRemoveTimer=null;this.iSizeLimit=100;this.mSupportedBindingModes={OneWay:true,TwoWay:true,OneTime:true};this.mUnsupportedFilterOperators={};this.sUpdateTimer=null;this.iSyncSetPropertyCalls=0;this.iUpdatedBindings=0;this.iTimeoutId=undefined},metadata:{abstract:true,publicMethods:["bindProperty","bindList","bindTree","bindContext","createBindingContext","destroyBindingContext","getProperty","getDefaultBindingMode","setDefaultBindingMode","isBindingModeSupported","attachParseError","detachParseError","attachRequestCompleted","detachRequestCompleted","attachRequestFailed","detachRequestFailed","attachRequestSent","detachRequestSent","attachPropertyChange","detachPropertyChange","setSizeLimit","refresh","isList","getObject"]}});h.M_EVENTS={ParseError:"parseError",RequestFailed:"requestFailed",RequestSent:"requestSent",RequestCompleted:"requestCompleted",PropertyChange:"propertyChange"};h.prototype.attachRequestFailed=function(t,e,i){this.attachEvent("requestFailed",t,e,i);return this};h.prototype.detachRequestFailed=function(t,e){this.detachEvent("requestFailed",t,e);return this};h.prototype.fireRequestFailed=function(t){this.fireEvent("requestFailed",t);return this};h.prototype.attachParseError=function(t,e,i){this.attachEvent("parseError",t,e,i);return this};h.prototype.detachParseError=function(t,e){this.detachEvent("parseError",t,e);return this};h.prototype.fireParseError=function(t){this.fireEvent("parseError",t);return this};h.prototype.attachRequestSent=function(t,e,i){this.attachEvent("requestSent",t,e,i);return this};h.prototype.detachRequestSent=function(t,e){this.detachEvent("requestSent",t,e);return this};h.prototype.fireRequestSent=function(t){this.fireEvent("requestSent",t);return this};h.prototype.attachRequestCompleted=function(t,e,i){this.attachEvent("requestCompleted",t,e,i);return this};h.prototype.detachRequestCompleted=function(t,e){this.detachEvent("requestCompleted",t,e);return this};h.prototype.fireRequestCompleted=function(t){this.fireEvent("requestCompleted",t);return this};h.prototype.firePropertyChange=function(t){this.fireEvent("propertyChange",t);return this};h.prototype.attachPropertyChange=function(t,e,i){this.attachEvent("propertyChange",t,e,i);return this};h.prototype.detachPropertyChange=function(t,e){this.detachEvent("propertyChange",t,e);return this};h.prototype.getObject=function(t,e,i){return this.getProperty(t,e,i)};h.prototype.getContext=function(t){if(!t.startsWith("/")){throw new Error("Path "+t+" must start with a / ")}var e=this.mContexts[t];if(!e){e=new n(this,t);this.mContexts[t]=e}return e};h.prototype.resolve=function(t,e){var i=typeof t=="string"&&!t.startsWith("/"),n=t,s;if(i){if(e){s=e.getPath();n=s+(s.endsWith("/")?"":"/")+t}else{n=undefined;if(this.isLegacySyntax()){n="/"+t}}}if(!t&&e){n=e.getPath()}if(n&&n!=="/"&&n.endsWith("/")){n=n.substr(0,n.length-1)}return n};h.prototype._cleanUpBindings=function(){var t=this.oBindingsToRemove;if(t.size>0){this.aBindings=this.aBindings.filter(function(e){return!t.has(e)});t.clear()}};h.prototype.addBinding=function(t){this._cleanUpBindings();this.aBindings.push(t)};h.prototype.getBindings=function(){this._cleanUpBindings();return this.aBindings.slice()};h.prototype.removeBinding=function(t){this.oBindingsToRemove.add(t);if(!this.sRemoveTimer){this.sRemoveTimer=setTimeout(function(){this.sRemoveTimer=null;this._cleanUpBindings()}.bind(this),0)}};h.prototype.getDefaultBindingMode=function(){return this.sDefaultBindingMode};h.prototype.setDefaultBindingMode=function(t){if(this.isBindingModeSupported(t)){this.sDefaultBindingMode=t;return this}throw new Error("Binding mode "+t+" is not supported by this model.",this)};h.prototype.isBindingModeSupported=function(t){return t in this.mSupportedBindingModes};h.prototype.setLegacySyntax=function(t){this.bLegacySyntax=t};h.prototype.isLegacySyntax=function(){return this.bLegacySyntax};h.prototype.setSizeLimit=function(t){this.iSizeLimit=t};h.prototype.getInterface=function(){return this};h.prototype.refresh=function(t){this.checkUpdate(t);if(t){var e=[];for(var i in this.mMessages){e=e.concat(this.mMessages[i])}var n=sap.ui.require("sap/ui/core/Messaging");if(n){n.updateMessages(e,[])}}};h.prototype.checkUpdate=function(t,e){if(e){this.bForceUpdate=this.bForceUpdate||t;if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(this.bForceUpdate)}.bind(this),0)}return 0}t=this.bForceUpdate||t;if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null;this.bForceUpdate=undefined}var i=this.getBindings();a(i,function(e,i){i.checkUpdate(t)});return i.length};h.prototype.checkPerformanceOfUpdate=function(t,e){if(e){return}this.iSyncSetPropertyCalls+=1;this.iUpdatedBindings+=t;if(this.iTimeoutId){return}const i=()=>{if(this.iSyncSetPropertyCalls>1&&this.iUpdatedBindings>1e5){const t=this.getMetadata().getName();r.warning(`Performance issue: ${this.iUpdatedBindings} (more than 100000) bindings are affected by `+`${this.iSyncSetPropertyCalls} consecutive synchronous calls to `+`${t.slice(t.lastIndexOf(".")+1)}#setProperty; `+`see API documentation for details`,undefined,t)}this.iTimeoutId=undefined;this.iSyncSetPropertyCalls=0;this.iUpdatedBindings=0};this.iTimeoutId=setTimeout(i,0)};h.prototype.setMessages=function(t){t=t||{};if(!o(this.mMessages,t)){this.mMessages=t;this.checkMessages()}};h.prototype.getMessagesByPath=function(t,e){var i=new Set,n=this;if(!e){return this.mMessages[t]||[]}Object.keys(this.mMessages).forEach(function(e){n.filterMatchingMessages(e,t).forEach(function(t){i.add(t)})});return Array.from(i)};h.prototype.filterMatchingMessages=function(t,e){if(t===e||t.startsWith(e==="/"?e:e+"/")){return this.mMessages[t]}return[]};h.prototype.checkMessages=function(){a(this.getBindings(),function(t,e){if(e.checkDataState){e.checkDataState()}})};h.prototype.destroy=function(){t.prototype.destroy.apply(this,arguments);this.oData={};this.aBindings=[];this.mContexts={};if(this.sRemoveTimer){clearTimeout(this.sRemoveTimer);this.sRemoveTimer=null;this.oBindingsToRemove.clear()}if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null}this.bDestroyed=true};h.prototype.getMetaModel=function(){return undefined};h.prototype.getOriginalProperty=function(t,e){return this.getProperty(t,e)};h.prototype.isLaundering=function(t,e){return false};h.prototype.checkFilter=function(t){s.checkFilterNone(t);h._traverseFilter(t,function(t){if(this.mUnsupportedFilterOperators[t.sOperator]){throw new Error("Filter instances contain an unsupported FilterOperator: "+t.sOperator)}}.bind(this))};h._traverseFilter=function(t,e){t=t||[];if(t instanceof s){t=[t]}for(var i=0;i<t.length;i++){var n=t[i];e(n);h._traverseFilter(n.oCondition,e);h._traverseFilter(n.aFilters,e)}};h.prototype.mixinBindingSupport=function(t){Object.assign(t,e)};return h});
//# sourceMappingURL=Model.js.map